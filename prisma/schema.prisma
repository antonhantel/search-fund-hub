// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  role          String    @default("employer")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  employer      Employer?
}

model Employer {
  id                String    @id @default(cuid())
  userId            String    @unique
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyName       String
  industry          String?
  website           String?
  linkedinUrl       String?
  description       String?
  teamProfile       String?
  status            String    @default("pending")
  approvedBy        String?
  approvedAt        DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  jobs              Job[]
}

model Job {
  id                    String        @id @default(cuid())
  employerId            String
  employer              Employer      @relation(fields: [employerId], references: [id], onDelete: Cascade)
  title                 String
  description           String
  requirements          String?
  languageRequirements  Json?
  location              Json?         // Array of location tags
  remoteAllowed         Boolean       @default(false)
  hybridAllowed         Boolean       @default(false)
  industry              String?
  functionArea          String?
  companySize           String?
  isFulltime            Boolean       @default(true)
  isParttime            Boolean       @default(false)
  parttimeHoursRange    String?
  startingDateAsap      Boolean       @default(true)
  startingDate          DateTime?
  status                String        @default("draft")
  approvedBy            String?
  approvedAt            DateTime?
  publishedAt           DateTime?
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  applications          Application[]
}

model Application {
  id              String    @id @default(cuid())
  jobId           String
  job             Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)
  candidateName   String
  candidateEmail  String
  linkedinUrl     String?
  resumeUrl       String?
  coverLetter     String?
  stage           String    @default("new")  // screening, interview, offer, rejected
  stageChangedAt  DateTime  @default(now())  // Track when stage was last changed
  notes           String?
  appliedAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model LocationTag {
  id        String   @id @default(cuid())
  name      String   @unique
  usageCount Int     @default(1)
  createdAt DateTime @default(now())
}
